{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/search-results.js"],"names":["INITIAL_INSERTER_RESULTS","EMPTY_ARRAY","InserterSearchResults","filterValue","onSelect","onHover","rootClientId","clientId","isAppender","__experimentalInsertionIndex","maxBlockPatterns","maxBlockTypes","showBlockDirectory","isDraggable","shouldFocusBlock","debouncedSpeak","speak","destinationRootClientId","onInsertBlocks","insertionIndex","blockTypes","blockTypeCategories","blockTypeCollections","onSelectBlockType","patterns","onSelectBlockPattern","filteredBlockTypes","results","undefined","slice","filteredBlockPatterns","count","length","resultsFoundMessage","currentShownBlockTypes","step","currentShownPatterns","hasItems","fills"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { orderBy, isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useMemo, useEffect } from '@wordpress/element';\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { VisuallyHidden } from '@wordpress/components';\nimport { useDebounce, useAsyncList } from '@wordpress/compose';\nimport { speak } from '@wordpress/a11y';\n\n/**\n * Internal dependencies\n */\nimport BlockTypesList from '../block-types-list';\nimport BlockPatternsList from '../block-patterns-list';\nimport __unstableInserterMenuExtension from '../inserter-menu-extension';\nimport InserterPanel from './panel';\nimport InserterNoResults from './no-results';\nimport useInsertionPoint from './hooks/use-insertion-point';\nimport usePatternsState from './hooks/use-patterns-state';\nimport useBlockTypesState from './hooks/use-block-types-state';\nimport { searchBlockItems, searchItems } from './search-items';\nimport InserterListbox from '../inserter-listbox';\n\nconst INITIAL_INSERTER_RESULTS = 9;\n/**\n * Shared reference to an empty array for cases where it is important to avoid\n * returning a new array reference on every invocation and rerendering the component.\n *\n * @type {Array}\n */\nconst EMPTY_ARRAY = [];\n\nfunction InserterSearchResults( {\n\tfilterValue,\n\tonSelect,\n\tonHover,\n\trootClientId,\n\tclientId,\n\tisAppender,\n\t__experimentalInsertionIndex,\n\tmaxBlockPatterns,\n\tmaxBlockTypes,\n\tshowBlockDirectory = false,\n\tisDraggable = true,\n\tshouldFocusBlock = true,\n} ) {\n\tconst debouncedSpeak = useDebounce( speak, 500 );\n\n\tconst [ destinationRootClientId, onInsertBlocks ] = useInsertionPoint( {\n\t\tonSelect,\n\t\trootClientId,\n\t\tclientId,\n\t\tisAppender,\n\t\tinsertionIndex: __experimentalInsertionIndex,\n\t\tshouldFocusBlock,\n\t} );\n\tconst [\n\t\tblockTypes,\n\t\tblockTypeCategories,\n\t\tblockTypeCollections,\n\t\tonSelectBlockType,\n\t] = useBlockTypesState( destinationRootClientId, onInsertBlocks );\n\tconst [ patterns, , onSelectBlockPattern ] = usePatternsState(\n\t\tonInsertBlocks,\n\t\tdestinationRootClientId\n\t);\n\n\tconst filteredBlockTypes = useMemo( () => {\n\t\tconst results = searchBlockItems(\n\t\t\torderBy( blockTypes, [ 'frecency' ], [ 'desc' ] ),\n\t\t\tblockTypeCategories,\n\t\t\tblockTypeCollections,\n\t\t\tfilterValue\n\t\t);\n\n\t\treturn maxBlockTypes !== undefined\n\t\t\t? results.slice( 0, maxBlockTypes )\n\t\t\t: results;\n\t}, [\n\t\tfilterValue,\n\t\tblockTypes,\n\t\tblockTypeCategories,\n\t\tblockTypeCollections,\n\t\tmaxBlockTypes,\n\t] );\n\n\tconst filteredBlockPatterns = useMemo( () => {\n\t\tconst results = searchItems( patterns, filterValue );\n\t\treturn maxBlockPatterns !== undefined\n\t\t\t? results.slice( 0, maxBlockPatterns )\n\t\t\t: results;\n\t}, [ filterValue, patterns, maxBlockPatterns ] );\n\n\t// Announce search results on change\n\tuseEffect( () => {\n\t\tif ( ! filterValue ) {\n\t\t\treturn;\n\t\t}\n\t\tconst count = filteredBlockTypes.length + filteredBlockPatterns.length;\n\t\tconst resultsFoundMessage = sprintf(\n\t\t\t/* translators: %d: number of results. */\n\t\t\t_n( '%d result found.', '%d results found.', count ),\n\t\t\tcount\n\t\t);\n\t\tdebouncedSpeak( resultsFoundMessage );\n\t}, [ filterValue, debouncedSpeak ] );\n\n\tconst currentShownBlockTypes = useAsyncList( filteredBlockTypes, {\n\t\tstep: INITIAL_INSERTER_RESULTS,\n\t} );\n\tconst currentShownPatterns = useAsyncList(\n\t\tcurrentShownBlockTypes.length === filteredBlockTypes.length\n\t\t\t? filteredBlockPatterns\n\t\t\t: EMPTY_ARRAY\n\t);\n\n\tconst hasItems =\n\t\t! isEmpty( filteredBlockTypes ) || ! isEmpty( filteredBlockPatterns );\n\n\treturn (\n\t\t<InserterListbox>\n\t\t\t{ ! showBlockDirectory && ! hasItems && <InserterNoResults /> }\n\n\t\t\t{ !! filteredBlockTypes.length && (\n\t\t\t\t<InserterPanel\n\t\t\t\t\ttitle={\n\t\t\t\t\t\t<VisuallyHidden>{ __( 'Blocks' ) }</VisuallyHidden>\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t<BlockTypesList\n\t\t\t\t\t\titems={ currentShownBlockTypes }\n\t\t\t\t\t\tonSelect={ onSelectBlockType }\n\t\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\t\tlabel={ __( 'Blocks' ) }\n\t\t\t\t\t\tisDraggable={ isDraggable }\n\t\t\t\t\t/>\n\t\t\t\t</InserterPanel>\n\t\t\t) }\n\n\t\t\t{ !! filteredBlockTypes.length &&\n\t\t\t\t!! filteredBlockPatterns.length && (\n\t\t\t\t\t<div className=\"block-editor-inserter__quick-inserter-separator\" />\n\t\t\t\t) }\n\n\t\t\t{ !! filteredBlockPatterns.length && (\n\t\t\t\t<InserterPanel\n\t\t\t\t\ttitle={\n\t\t\t\t\t\t<VisuallyHidden>\n\t\t\t\t\t\t\t{ __( 'Block Patterns' ) }\n\t\t\t\t\t\t</VisuallyHidden>\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"block-editor-inserter__quick-inserter-patterns\">\n\t\t\t\t\t\t<BlockPatternsList\n\t\t\t\t\t\t\tshownPatterns={ currentShownPatterns }\n\t\t\t\t\t\t\tblockPatterns={ filteredBlockPatterns }\n\t\t\t\t\t\t\tonClickPattern={ onSelectBlockPattern }\n\t\t\t\t\t\t\tisDraggable={ isDraggable }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</InserterPanel>\n\t\t\t) }\n\n\t\t\t{ showBlockDirectory && (\n\t\t\t\t<__unstableInserterMenuExtension.Slot\n\t\t\t\t\tfillProps={ {\n\t\t\t\t\t\tonSelect: onSelectBlockType,\n\t\t\t\t\t\tonHover,\n\t\t\t\t\t\tfilterValue,\n\t\t\t\t\t\thasItems,\n\t\t\t\t\t\trootClientId: destinationRootClientId,\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t{ ( fills ) => {\n\t\t\t\t\t\tif ( fills.length ) {\n\t\t\t\t\t\t\treturn fills;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( ! hasItems ) {\n\t\t\t\t\t\t\treturn <InserterNoResults />;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} }\n\t\t\t\t</__unstableInserterMenuExtension.Slot>\n\t\t\t) }\n\t\t</InserterListbox>\n\t);\n}\n\nexport default InserterSearchResults;\n"]}