{"version":3,"sources":["@wordpress/block-editor/src/components/iframe/index.js"],"names":["BODY_CLASS_NAME","BLOCK_PREFIX","styleSheetsCompat","doc","Array","from","document","styleSheets","forEach","styleSheet","cssRules","e","ownerNode","tagName","id","isMatch","find","selectorText","includes","getElementById","console","error","outerHTML","head","appendChild","cloneNode","inlineCssId","replace","inlineCssElement","bubbleEvents","defaultView","frameElement","bubbleEvent","event","prototype","Object","getPrototypeOf","constructorName","constructor","name","Constructor","window","init","key","MouseEvent","rect","getBoundingClientRect","clientX","left","clientY","top","newEvent","type","cancelled","dispatchEvent","preventDefault","eventTypes","addEventListener","setBodyClassName","dir","body","className","classList","startsWith","add","useParsedAssets","html","implementation","createHTMLDocument","innerHTML","children","loadScript","src","Promise","resolve","reject","script","createElement","onload","onerror","Iframe","contentRef","props","ref","forceRender","iframeDocument","setIframeDocument","styles","__editorAssets","scripts","clearerRef","before","writingFlowRef","after","setRef","node","setDocumentIfReady","contentDocument","readyState","documentElement","current","reduce","promise","then","finally","map","href","rel","media","textContent","TagName","toLowerCase"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tuseState,\n\tcreatePortal,\n\tuseCallback,\n\tforwardRef,\n\tuseEffect,\n\tuseMemo,\n\tuseReducer,\n} from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { useMergeRefs } from '@wordpress/compose';\nimport { __experimentalStyleProvider as StyleProvider } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport { useBlockSelectionClearer } from '../block-selection-clearer';\nimport { useWritingFlow } from '../writing-flow';\n\nconst BODY_CLASS_NAME = 'editor-styles-wrapper';\nconst BLOCK_PREFIX = 'wp-block';\n\n/**\n * Clones stylesheets targetting the editor canvas to the given document. A\n * stylesheet is considered targetting the editor a canvas if it contains the\n * `editor-styles-wrapper`, `wp-block`, or `wp-block-*` class selectors.\n *\n * Ideally, this hook should be removed in the future and styles should be added\n * explicitly as editor styles.\n *\n * @param {Document} doc The document to append cloned stylesheets to.\n */\nfunction styleSheetsCompat( doc ) {\n\t// Search the document for stylesheets targetting the editor canvas.\n\tArray.from( document.styleSheets ).forEach( ( styleSheet ) => {\n\t\ttry {\n\t\t\t// May fail for external styles.\n\t\t\t// eslint-disable-next-line no-unused-expressions\n\t\t\tstyleSheet.cssRules;\n\t\t} catch ( e ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { ownerNode, cssRules } = styleSheet;\n\n\t\tif ( ! cssRules ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Generally, ignore inline styles. We add inline styles belonging to a\n\t\t// stylesheet later, which may or may not match the selectors.\n\t\tif ( ownerNode.tagName !== 'LINK' ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Don't try to add the reset styles, which were removed as a dependency\n\t\t// from `edit-blocks` for the iframe since we don't need to reset admin\n\t\t// styles.\n\t\tif ( ownerNode.id === 'wp-reset-editor-styles-css' ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isMatch = Array.from( cssRules ).find(\n\t\t\t( { selectorText } ) =>\n\t\t\t\tselectorText &&\n\t\t\t\t( selectorText.includes( `.${ BODY_CLASS_NAME }` ) ||\n\t\t\t\t\tselectorText.includes( `.${ BLOCK_PREFIX }` ) )\n\t\t);\n\n\t\tif ( isMatch && ! doc.getElementById( ownerNode.id ) ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error(\n\t\t\t\t`Stylesheet ${ ownerNode.id } was not properly added.\nFor blocks, use the block API's style (https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/#style) or editorStyle (https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/#editor-style).\nFor themes, use add_editor_style (https://developer.wordpress.org/block-editor/how-to-guides/themes/theme-support/#editor-styles).`,\n\t\t\t\townerNode.outerHTML\n\t\t\t);\n\t\t\tdoc.head.appendChild( ownerNode.cloneNode( true ) );\n\n\t\t\t// Add inline styles belonging to the stylesheet.\n\t\t\tconst inlineCssId = ownerNode.id.replace( '-css', '-inline-css' );\n\t\t\tconst inlineCssElement = document.getElementById( inlineCssId );\n\n\t\t\tif ( inlineCssElement ) {\n\t\t\t\tdoc.head.appendChild( inlineCssElement.cloneNode( true ) );\n\t\t\t}\n\t\t}\n\t} );\n}\n\n/**\n * Bubbles some event types (keydown, keypress, and dragover) to parent document\n * document to ensure that the keyboard shortcuts and drag and drop work.\n *\n * Ideally, we should remove event bubbling in the future. Keyboard shortcuts\n * should be context dependent, e.g. actions on blocks like Cmd+A should not\n * work globally outside the block editor.\n *\n * @param {Document} doc Document to attach listeners to.\n */\nfunction bubbleEvents( doc ) {\n\tconst { defaultView } = doc;\n\tconst { frameElement } = defaultView;\n\n\tfunction bubbleEvent( event ) {\n\t\tconst prototype = Object.getPrototypeOf( event );\n\t\tconst constructorName = prototype.constructor.name;\n\t\tconst Constructor = window[ constructorName ];\n\n\t\tconst init = {};\n\n\t\tfor ( const key in event ) {\n\t\t\tinit[ key ] = event[ key ];\n\t\t}\n\n\t\tif ( event instanceof defaultView.MouseEvent ) {\n\t\t\tconst rect = frameElement.getBoundingClientRect();\n\t\t\tinit.clientX += rect.left;\n\t\t\tinit.clientY += rect.top;\n\t\t}\n\n\t\tconst newEvent = new Constructor( event.type, init );\n\t\tconst cancelled = ! frameElement.dispatchEvent( newEvent );\n\n\t\tif ( cancelled ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tconst eventTypes = [ 'keydown', 'keypress', 'dragover' ];\n\n\tfor ( const name of eventTypes ) {\n\t\tdoc.addEventListener( name, bubbleEvent );\n\t}\n}\n\n/**\n * Sets the document direction.\n *\n * Sets the `editor-styles-wrapper` class name on the body.\n *\n * Copies the `admin-color-*` class name to the body so that the admin color\n * scheme applies to components in the iframe.\n *\n * @param {Document} doc Document to add class name to.\n */\nfunction setBodyClassName( doc ) {\n\tdoc.dir = document.dir;\n\tdoc.body.className = BODY_CLASS_NAME;\n\n\tfor ( const name of document.body.classList ) {\n\t\tif ( name.startsWith( 'admin-color-' ) ) {\n\t\t\tdoc.body.classList.add( name );\n\t\t} else if ( name === 'wp-embed-responsive' ) {\n\t\t\t// Ideally ALL classes that are added through get_body_class should\n\t\t\t// be added in the editor too, which we'll somehow have to get from\n\t\t\t// the server in the future (which will run the PHP filters).\n\t\t\tdoc.body.classList.add( 'wp-embed-responsive' );\n\t\t}\n\t}\n}\n\nfunction useParsedAssets( html ) {\n\treturn useMemo( () => {\n\t\tconst doc = document.implementation.createHTMLDocument( '' );\n\t\tdoc.body.innerHTML = html;\n\t\treturn Array.from( doc.body.children );\n\t}, [ html ] );\n}\n\nasync function loadScript( doc, { id, src } ) {\n\treturn new Promise( ( resolve, reject ) => {\n\t\tconst script = doc.createElement( 'script' );\n\t\tscript.id = id;\n\t\tif ( src ) {\n\t\t\tscript.src = src;\n\t\t\tscript.onload = () => resolve();\n\t\t\tscript.onerror = () => reject();\n\t\t} else {\n\t\t\tresolve();\n\t\t}\n\t\tdoc.head.appendChild( script );\n\t} );\n}\n\nfunction Iframe( { contentRef, children, head, ...props }, ref ) {\n\tconst [ , forceRender ] = useReducer( () => ( {} ) );\n\tconst [ iframeDocument, setIframeDocument ] = useState();\n\tconst styles = useParsedAssets( window.__editorAssets.styles );\n\tconst scripts = useParsedAssets( window.__editorAssets.scripts );\n\tconst clearerRef = useBlockSelectionClearer();\n\tconst [ before, writingFlowRef, after ] = useWritingFlow();\n\tconst setRef = useCallback( ( node ) => {\n\t\tif ( ! node ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction setDocumentIfReady() {\n\t\t\tconst { contentDocument } = node;\n\t\t\tconst { readyState, body, documentElement } = contentDocument;\n\n\t\t\tif ( readyState !== 'interactive' && readyState !== 'complete' ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif ( typeof contentRef === 'function' ) {\n\t\t\t\tcontentRef( body );\n\t\t\t} else if ( contentRef ) {\n\t\t\t\tcontentRef.current = body;\n\t\t\t}\n\n\t\t\tsetBodyClassName( contentDocument );\n\t\t\tbubbleEvents( contentDocument );\n\t\t\tsetBodyClassName( contentDocument );\n\t\t\tsetIframeDocument( contentDocument );\n\t\t\tclearerRef( documentElement );\n\t\t\tclearerRef( body );\n\t\t\twritingFlowRef( body );\n\n\t\t\tscripts\n\t\t\t\t.reduce(\n\t\t\t\t\t( promise, script ) =>\n\t\t\t\t\t\tpromise.then( () =>\n\t\t\t\t\t\t\tloadScript( contentDocument, script )\n\t\t\t\t\t\t),\n\t\t\t\t\tPromise.resolve()\n\t\t\t\t)\n\t\t\t\t.finally( () => {\n\t\t\t\t\t// When script are loaded, re-render blocks to allow them\n\t\t\t\t\t// to initialise.\n\t\t\t\t\tforceRender();\n\t\t\t\t} );\n\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( setDocumentIfReady() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Document is not immediately loaded in Firefox.\n\t\tnode.addEventListener( 'load', () => {\n\t\t\tsetDocumentIfReady();\n\t\t} );\n\t}, [] );\n\n\tuseEffect( () => {\n\t\tif ( iframeDocument ) {\n\t\t\tstyleSheetsCompat( iframeDocument );\n\t\t}\n\t}, [ iframeDocument ] );\n\n\thead = (\n\t\t<>\n\t\t\t<style>{ 'body{margin:0}' }</style>\n\t\t\t{ styles.map(\n\t\t\t\t( { tagName, href, id, rel, media, textContent } ) => {\n\t\t\t\t\tconst TagName = tagName.toLowerCase();\n\n\t\t\t\t\tif ( TagName === 'style' ) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<TagName { ...{ id } } key={ id }>\n\t\t\t\t\t\t\t\t{ textContent }\n\t\t\t\t\t\t\t</TagName>\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<TagName { ...{ href, id, rel, media } } key={ id } />\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t) }\n\t\t\t{ head }\n\t\t</>\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{ before }\n\t\t\t<iframe\n\t\t\t\t{ ...props }\n\t\t\t\tref={ useMergeRefs( [ ref, setRef ] ) }\n\t\t\t\ttabIndex=\"0\"\n\t\t\t\ttitle={ __( 'Editor canvas' ) }\n\t\t\t\tname=\"editor-canvas\"\n\t\t\t>\n\t\t\t\t{ iframeDocument &&\n\t\t\t\t\tcreatePortal(\n\t\t\t\t\t\t<StyleProvider document={ iframeDocument }>\n\t\t\t\t\t\t\t{ children }\n\t\t\t\t\t\t</StyleProvider>,\n\t\t\t\t\t\tiframeDocument.body\n\t\t\t\t\t) }\n\t\t\t\t{ iframeDocument && createPortal( head, iframeDocument.head ) }\n\t\t\t</iframe>\n\t\t\t{ after }\n\t\t</>\n\t);\n}\n\nexport default forwardRef( Iframe );\n"]}