{"version":3,"sources":["@wordpress/components/src/form-token-field/index.js"],"names":["last","take","clone","uniq","map","difference","each","identity","some","classnames","__","_n","sprintf","Component","withInstanceId","BACKSPACE","ENTER","UP","DOWN","LEFT","RIGHT","SPACE","DELETE","ESCAPE","isShallowEqual","Token","TokenInput","SuggestionsList","withSpokenMessages","initialState","incompleteTokenValue","inputOffsetFromEnd","isActive","isExpanded","selectedSuggestionIndex","selectedSuggestionScroll","FormTokenField","constructor","arguments","state","onKeyDown","bind","onKeyPress","onFocus","onBlur","deleteTokenBeforeInput","deleteTokenAfterInput","addCurrentToken","onContainerTouched","renderToken","onTokenClickRemove","onSuggestionHovered","onSuggestionSelected","onInputChange","bindInput","bindTokensAndInput","updateSuggestions","componentDidUpdate","prevProps","input","hasFocus","focus","suggestions","value","props","suggestionsDidUpdate","getDerivedStateFromProps","disabled","ref","tokensAndInput","event","__experimentalExpandOnFocus","target","setState","inputHasValidValue","preventDefault","defaultPrevented","keyCode","handleDeleteKey","handleLeftArrowKey","handleUpArrowKey","handleRightArrowKey","handleDownArrowKey","tokenizeOnSpace","handleEscapeKey","charCode","handleCommaKey","deleteToken","suggestion","index","getMatchingSuggestions","indexOf","addNewToken","text","separator","items","split","tokenValue","length","addNewTokens","slice","isInputEmpty","moveInputBeforePreviousToken","moveInputAfterNextToken","maxSuggestions","saveTransform","moveInputToIndex","Math","max","min","getIndexOfInput","selectedSuggestion","getSelectedSuggestion","tokens","tokensToAdd","filter","Boolean","token","valueContainsToken","newValue","splice","apply","concat","onChange","__experimentalValidateInput","speak","messages","__experimentalInvalid","added","newTokens","item","getTokenValue","removed","searchValue","match","startsWithMatch","containsMatch","toLocaleLowerCase","push","resetSelectedSuggestion","inputHasMinimumChars","trim","matchingSuggestions","hasMatchingSuggestions","newState","debouncedSpeak","message","renderTokensAndInput","components","renderInput","status","undefined","termPosition","termsCount","title","displayTransform","isBorderless","onMouseEnter","onMouseLeave","autoCapitalize","autoComplete","maxLength","placeholder","instanceId","key","render","label","className","__experimentalShowHowTo","classes","tokenFieldProps","tabIndex","Object","assign","defaultProps","freeze","remove"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tlast,\n\ttake,\n\tclone,\n\tuniq,\n\tmap,\n\tdifference,\n\teach,\n\tidentity,\n\tsome,\n} from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { withInstanceId } from '@wordpress/compose';\nimport {\n\tBACKSPACE,\n\tENTER,\n\tUP,\n\tDOWN,\n\tLEFT,\n\tRIGHT,\n\tSPACE,\n\tDELETE,\n\tESCAPE,\n} from '@wordpress/keycodes';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport Token from './token';\nimport TokenInput from './token-input';\nimport SuggestionsList from './suggestions-list';\nimport withSpokenMessages from '../higher-order/with-spoken-messages';\n\nconst initialState = {\n\tincompleteTokenValue: '',\n\tinputOffsetFromEnd: 0,\n\tisActive: false,\n\tisExpanded: false,\n\tselectedSuggestionIndex: -1,\n\tselectedSuggestionScroll: false,\n};\n\nclass FormTokenField extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = initialState;\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.onKeyPress = this.onKeyPress.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.deleteTokenBeforeInput = this.deleteTokenBeforeInput.bind( this );\n\t\tthis.deleteTokenAfterInput = this.deleteTokenAfterInput.bind( this );\n\t\tthis.addCurrentToken = this.addCurrentToken.bind( this );\n\t\tthis.onContainerTouched = this.onContainerTouched.bind( this );\n\t\tthis.renderToken = this.renderToken.bind( this );\n\t\tthis.onTokenClickRemove = this.onTokenClickRemove.bind( this );\n\t\tthis.onSuggestionHovered = this.onSuggestionHovered.bind( this );\n\t\tthis.onSuggestionSelected = this.onSuggestionSelected.bind( this );\n\t\tthis.onInputChange = this.onInputChange.bind( this );\n\t\tthis.bindInput = this.bindInput.bind( this );\n\t\tthis.bindTokensAndInput = this.bindTokensAndInput.bind( this );\n\t\tthis.updateSuggestions = this.updateSuggestions.bind( this );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\t// Make sure to focus the input when the isActive state is true.\n\t\tif ( this.state.isActive && ! this.input.hasFocus() ) {\n\t\t\tthis.input.focus();\n\t\t}\n\n\t\tconst { suggestions, value } = this.props;\n\t\tconst suggestionsDidUpdate = ! isShallowEqual(\n\t\t\tsuggestions,\n\t\t\tprevProps.suggestions\n\t\t);\n\t\tif ( suggestionsDidUpdate || value !== prevProps.value ) {\n\t\t\tthis.updateSuggestions( suggestionsDidUpdate );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\tif ( ! props.disabled || ! state.isActive ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tisActive: false,\n\t\t\tincompleteTokenValue: '',\n\t\t};\n\t}\n\n\tbindInput( ref ) {\n\t\tthis.input = ref;\n\t}\n\n\tbindTokensAndInput( ref ) {\n\t\tthis.tokensAndInput = ref;\n\t}\n\n\tonFocus( event ) {\n\t\tconst { __experimentalExpandOnFocus } = this.props;\n\t\t// If focus is on the input or on the container, set the isActive state to true.\n\t\tif ( this.input.hasFocus() || event.target === this.tokensAndInput ) {\n\t\t\tthis.setState( {\n\t\t\t\tisActive: true,\n\t\t\t\tisExpanded:\n\t\t\t\t\t!! __experimentalExpandOnFocus || this.state.isExpanded,\n\t\t\t} );\n\t\t} else {\n\t\t\t/*\n\t\t\t * Otherwise, focus is on one of the token \"remove\" buttons and we\n\t\t\t * set the isActive state to false to prevent the input to be\n\t\t\t * re-focused, see componentDidUpdate().\n\t\t\t */\n\t\t\tthis.setState( { isActive: false } );\n\t\t}\n\n\t\tif ( 'function' === typeof this.props.onFocus ) {\n\t\t\tthis.props.onFocus( event );\n\t\t}\n\t}\n\n\tonBlur() {\n\t\tif ( this.inputHasValidValue() ) {\n\t\t\tthis.setState( { isActive: false } );\n\t\t} else {\n\t\t\tthis.setState( initialState );\n\t\t}\n\t}\n\n\tonKeyDown( event ) {\n\t\tlet preventDefault = false;\n\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase BACKSPACE:\n\t\t\t\tpreventDefault = this.handleDeleteKey(\n\t\t\t\t\tthis.deleteTokenBeforeInput\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase ENTER:\n\t\t\t\tpreventDefault = this.addCurrentToken();\n\t\t\t\tbreak;\n\t\t\tcase LEFT:\n\t\t\t\tpreventDefault = this.handleLeftArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase UP:\n\t\t\t\tpreventDefault = this.handleUpArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase RIGHT:\n\t\t\t\tpreventDefault = this.handleRightArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\tpreventDefault = this.handleDownArrowKey();\n\t\t\t\tbreak;\n\t\t\tcase DELETE:\n\t\t\t\tpreventDefault = this.handleDeleteKey(\n\t\t\t\t\tthis.deleteTokenAfterInput\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase SPACE:\n\t\t\t\tif ( this.props.tokenizeOnSpace ) {\n\t\t\t\t\tpreventDefault = this.addCurrentToken();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ESCAPE:\n\t\t\t\tpreventDefault = this.handleEscapeKey( event );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonKeyPress( event ) {\n\t\tlet preventDefault = false;\n\t\tswitch ( event.charCode ) {\n\t\t\tcase 44: // comma\n\t\t\t\tpreventDefault = this.handleCommaKey();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonContainerTouched( event ) {\n\t\t// Prevent clicking/touching the tokensAndInput container from blurring\n\t\t// the input and adding the current token.\n\t\tif ( event.target === this.tokensAndInput && this.state.isActive ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tonTokenClickRemove( event ) {\n\t\tthis.deleteToken( event.value );\n\t\tthis.input.focus();\n\t}\n\n\tonSuggestionHovered( suggestion ) {\n\t\tconst index = this.getMatchingSuggestions().indexOf( suggestion );\n\n\t\tif ( index >= 0 ) {\n\t\t\tthis.setState( {\n\t\t\t\tselectedSuggestionIndex: index,\n\t\t\t\tselectedSuggestionScroll: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonSuggestionSelected( suggestion ) {\n\t\tthis.addNewToken( suggestion );\n\t}\n\n\tonInputChange( event ) {\n\t\tconst text = event.value;\n\t\tconst separator = this.props.tokenizeOnSpace ? /[ ,\\t]+/ : /[,\\t]+/;\n\t\tconst items = text.split( separator );\n\t\tconst tokenValue = last( items ) || '';\n\n\t\tif ( items.length > 1 ) {\n\t\t\tthis.addNewTokens( items.slice( 0, -1 ) );\n\t\t}\n\n\t\tthis.setState(\n\t\t\t{ incompleteTokenValue: tokenValue },\n\t\t\tthis.updateSuggestions\n\t\t);\n\n\t\tthis.props.onInputChange( tokenValue );\n\t}\n\n\thandleDeleteKey( deleteToken ) {\n\t\tlet preventDefault = false;\n\t\tif ( this.input.hasFocus() && this.isInputEmpty() ) {\n\t\t\tdeleteToken();\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\thandleLeftArrowKey() {\n\t\tlet preventDefault = false;\n\t\tif ( this.isInputEmpty() ) {\n\t\t\tthis.moveInputBeforePreviousToken();\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\thandleRightArrowKey() {\n\t\tlet preventDefault = false;\n\t\tif ( this.isInputEmpty() ) {\n\t\t\tthis.moveInputAfterNextToken();\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\thandleUpArrowKey() {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tselectedSuggestionIndex:\n\t\t\t\t( state.selectedSuggestionIndex === 0\n\t\t\t\t\t? this.getMatchingSuggestions(\n\t\t\t\t\t\t\tstate.incompleteTokenValue,\n\t\t\t\t\t\t\tprops.suggestions,\n\t\t\t\t\t\t\tprops.value,\n\t\t\t\t\t\t\tprops.maxSuggestions,\n\t\t\t\t\t\t\tprops.saveTransform\n\t\t\t\t\t  ).length\n\t\t\t\t\t: state.selectedSuggestionIndex ) - 1,\n\t\t\tselectedSuggestionScroll: true,\n\t\t} ) );\n\n\t\treturn true; // preventDefault\n\t}\n\n\thandleDownArrowKey() {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tselectedSuggestionIndex:\n\t\t\t\t( state.selectedSuggestionIndex + 1 ) %\n\t\t\t\tthis.getMatchingSuggestions(\n\t\t\t\t\tstate.incompleteTokenValue,\n\t\t\t\t\tprops.suggestions,\n\t\t\t\t\tprops.value,\n\t\t\t\t\tprops.maxSuggestions,\n\t\t\t\t\tprops.saveTransform\n\t\t\t\t).length,\n\t\t\tselectedSuggestionScroll: true,\n\t\t} ) );\n\n\t\treturn true; // preventDefault\n\t}\n\n\thandleEscapeKey( event ) {\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: event.target.value,\n\t\t\tisExpanded: false,\n\t\t\tselectedSuggestionIndex: -1,\n\t\t\tselectedSuggestionScroll: false,\n\t\t} );\n\t\treturn true; // preventDefault\n\t}\n\n\thandleCommaKey() {\n\t\tif ( this.inputHasValidValue() ) {\n\t\t\tthis.addNewToken( this.state.incompleteTokenValue );\n\t\t}\n\n\t\treturn true; // preventDefault\n\t}\n\n\tmoveInputToIndex( index ) {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tinputOffsetFromEnd: props.value.length - Math.max( index, -1 ) - 1,\n\t\t} ) );\n\t}\n\n\tmoveInputBeforePreviousToken() {\n\t\tthis.setState( ( state, props ) => ( {\n\t\t\tinputOffsetFromEnd: Math.min(\n\t\t\t\tstate.inputOffsetFromEnd + 1,\n\t\t\t\tprops.value.length\n\t\t\t),\n\t\t} ) );\n\t}\n\n\tmoveInputAfterNextToken() {\n\t\tthis.setState( ( state ) => ( {\n\t\t\tinputOffsetFromEnd: Math.max( state.inputOffsetFromEnd - 1, 0 ),\n\t\t} ) );\n\t}\n\n\tdeleteTokenBeforeInput() {\n\t\tconst index = this.getIndexOfInput() - 1;\n\n\t\tif ( index > -1 ) {\n\t\t\tthis.deleteToken( this.props.value[ index ] );\n\t\t}\n\t}\n\n\tdeleteTokenAfterInput() {\n\t\tconst index = this.getIndexOfInput();\n\n\t\tif ( index < this.props.value.length ) {\n\t\t\tthis.deleteToken( this.props.value[ index ] );\n\t\t\t// update input offset since it's the offset from the last token\n\t\t\tthis.moveInputToIndex( index );\n\t\t}\n\t}\n\n\taddCurrentToken() {\n\t\tlet preventDefault = false;\n\t\tconst selectedSuggestion = this.getSelectedSuggestion();\n\n\t\tif ( selectedSuggestion ) {\n\t\t\tthis.addNewToken( selectedSuggestion );\n\t\t\tpreventDefault = true;\n\t\t} else if ( this.inputHasValidValue() ) {\n\t\t\tthis.addNewToken( this.state.incompleteTokenValue );\n\t\t\tpreventDefault = true;\n\t\t}\n\n\t\treturn preventDefault;\n\t}\n\n\taddNewTokens( tokens ) {\n\t\tconst tokensToAdd = uniq(\n\t\t\ttokens\n\t\t\t\t.map( this.props.saveTransform )\n\t\t\t\t.filter( Boolean )\n\t\t\t\t.filter( ( token ) => ! this.valueContainsToken( token ) )\n\t\t);\n\n\t\tif ( tokensToAdd.length > 0 ) {\n\t\t\tconst newValue = clone( this.props.value );\n\t\t\tnewValue.splice.apply(\n\t\t\t\tnewValue,\n\t\t\t\t[ this.getIndexOfInput(), 0 ].concat( tokensToAdd )\n\t\t\t);\n\t\t\tthis.props.onChange( newValue );\n\t\t}\n\t}\n\n\taddNewToken( token ) {\n\t\tconst {\n\t\t\t__experimentalExpandOnFocus,\n\t\t\t__experimentalValidateInput,\n\t\t} = this.props;\n\t\tif ( ! __experimentalValidateInput( token ) ) {\n\t\t\tthis.props.speak(\n\t\t\t\tthis.props.messages.__experimentalInvalid,\n\t\t\t\t'assertive'\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tthis.addNewTokens( [ token ] );\n\t\tthis.props.speak( this.props.messages.added, 'assertive' );\n\n\t\tthis.setState( {\n\t\t\tincompleteTokenValue: '',\n\t\t\tselectedSuggestionIndex: -1,\n\t\t\tselectedSuggestionScroll: false,\n\t\t\tisExpanded: ! __experimentalExpandOnFocus,\n\t\t} );\n\n\t\tif ( this.state.isActive ) {\n\t\t\tthis.input.focus();\n\t\t}\n\t}\n\n\tdeleteToken( token ) {\n\t\tconst newTokens = this.props.value.filter( ( item ) => {\n\t\t\treturn this.getTokenValue( item ) !== this.getTokenValue( token );\n\t\t} );\n\t\tthis.props.onChange( newTokens );\n\t\tthis.props.speak( this.props.messages.removed, 'assertive' );\n\t}\n\n\tgetTokenValue( token ) {\n\t\tif ( 'object' === typeof token ) {\n\t\t\treturn token.value;\n\t\t}\n\n\t\treturn token;\n\t}\n\n\tgetMatchingSuggestions(\n\t\tsearchValue = this.state.incompleteTokenValue,\n\t\tsuggestions = this.props.suggestions,\n\t\tvalue = this.props.value,\n\t\tmaxSuggestions = this.props.maxSuggestions,\n\t\tsaveTransform = this.props.saveTransform\n\t) {\n\t\tlet match = saveTransform( searchValue );\n\t\tconst startsWithMatch = [];\n\t\tconst containsMatch = [];\n\n\t\tif ( match.length === 0 ) {\n\t\t\tsuggestions = difference( suggestions, value );\n\t\t} else {\n\t\t\tmatch = match.toLocaleLowerCase();\n\n\t\t\teach( suggestions, ( suggestion ) => {\n\t\t\t\tconst index = suggestion.toLocaleLowerCase().indexOf( match );\n\t\t\t\tif ( value.indexOf( suggestion ) === -1 ) {\n\t\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\t\tstartsWithMatch.push( suggestion );\n\t\t\t\t\t} else if ( index > 0 ) {\n\t\t\t\t\t\tcontainsMatch.push( suggestion );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tsuggestions = startsWithMatch.concat( containsMatch );\n\t\t}\n\n\t\treturn take( suggestions, maxSuggestions );\n\t}\n\n\tgetSelectedSuggestion() {\n\t\tif ( this.state.selectedSuggestionIndex !== -1 ) {\n\t\t\treturn this.getMatchingSuggestions()[\n\t\t\t\tthis.state.selectedSuggestionIndex\n\t\t\t];\n\t\t}\n\t}\n\n\tvalueContainsToken( token ) {\n\t\treturn some( this.props.value, ( item ) => {\n\t\t\treturn this.getTokenValue( token ) === this.getTokenValue( item );\n\t\t} );\n\t}\n\n\tgetIndexOfInput() {\n\t\treturn this.props.value.length - this.state.inputOffsetFromEnd;\n\t}\n\n\tisInputEmpty() {\n\t\treturn this.state.incompleteTokenValue.length === 0;\n\t}\n\n\tinputHasValidValue() {\n\t\treturn (\n\t\t\tthis.props.saveTransform( this.state.incompleteTokenValue ).length >\n\t\t\t0\n\t\t);\n\t}\n\n\tupdateSuggestions( resetSelectedSuggestion = true ) {\n\t\tconst { __experimentalExpandOnFocus } = this.props;\n\t\tconst { incompleteTokenValue } = this.state;\n\n\t\tconst inputHasMinimumChars = incompleteTokenValue.trim().length > 1;\n\t\tconst matchingSuggestions = this.getMatchingSuggestions(\n\t\t\tincompleteTokenValue\n\t\t);\n\t\tconst hasMatchingSuggestions = matchingSuggestions.length > 0;\n\n\t\tconst newState = {\n\t\t\tisExpanded:\n\t\t\t\t__experimentalExpandOnFocus ||\n\t\t\t\t( inputHasMinimumChars && hasMatchingSuggestions ),\n\t\t};\n\t\tif ( resetSelectedSuggestion ) {\n\t\t\tnewState.selectedSuggestionIndex = -1;\n\t\t\tnewState.selectedSuggestionScroll = false;\n\t\t}\n\n\t\tthis.setState( newState );\n\n\t\tif ( inputHasMinimumChars ) {\n\t\t\tconst { debouncedSpeak } = this.props;\n\n\t\t\tconst message = hasMatchingSuggestions\n\t\t\t\t? sprintf(\n\t\t\t\t\t\t/* translators: %d: number of results. */\n\t\t\t\t\t\t_n(\n\t\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t  )\n\t\t\t\t: __( 'No results.' );\n\n\t\t\tdebouncedSpeak( message, 'assertive' );\n\t\t}\n\t}\n\n\trenderTokensAndInput() {\n\t\tconst components = map( this.props.value, this.renderToken );\n\t\tcomponents.splice( this.getIndexOfInput(), 0, this.renderInput() );\n\n\t\treturn components;\n\t}\n\n\trenderToken( token, index, tokens ) {\n\t\tconst value = this.getTokenValue( token );\n\t\tconst status = token.status ? token.status : undefined;\n\t\tconst termPosition = index + 1;\n\t\tconst termsCount = tokens.length;\n\n\t\treturn (\n\t\t\t<Token\n\t\t\t\tkey={ 'token-' + value }\n\t\t\t\tvalue={ value }\n\t\t\t\tstatus={ status }\n\t\t\t\ttitle={ token.title }\n\t\t\t\tdisplayTransform={ this.props.displayTransform }\n\t\t\t\tonClickRemove={ this.onTokenClickRemove }\n\t\t\t\tisBorderless={ token.isBorderless || this.props.isBorderless }\n\t\t\t\tonMouseEnter={ token.onMouseEnter }\n\t\t\t\tonMouseLeave={ token.onMouseLeave }\n\t\t\t\tdisabled={ 'error' !== status && this.props.disabled }\n\t\t\t\tmessages={ this.props.messages }\n\t\t\t\ttermsCount={ termsCount }\n\t\t\t\ttermPosition={ termPosition }\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderInput() {\n\t\tconst {\n\t\t\tautoCapitalize,\n\t\t\tautoComplete,\n\t\t\tmaxLength,\n\t\t\tplaceholder,\n\t\t\tvalue,\n\t\t\tinstanceId,\n\t\t} = this.props;\n\n\t\tlet props = {\n\t\t\tinstanceId,\n\t\t\tautoCapitalize,\n\t\t\tautoComplete,\n\t\t\tplaceholder: value.length === 0 ? placeholder : '',\n\t\t\tref: this.bindInput,\n\t\t\tkey: 'input',\n\t\t\tdisabled: this.props.disabled,\n\t\t\tvalue: this.state.incompleteTokenValue,\n\t\t\tonBlur: this.onBlur,\n\t\t\tisExpanded: this.state.isExpanded,\n\t\t\tselectedSuggestionIndex: this.state.selectedSuggestionIndex,\n\t\t};\n\n\t\tif ( ! ( maxLength && value.length >= maxLength ) ) {\n\t\t\tprops = { ...props, onChange: this.onInputChange };\n\t\t}\n\n\t\treturn <TokenInput { ...props } />;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tdisabled,\n\t\t\tlabel = __( 'Add item' ),\n\t\t\tinstanceId,\n\t\t\tclassName,\n\t\t\t__experimentalShowHowTo,\n\t\t} = this.props;\n\t\tconst { isExpanded } = this.state;\n\t\tconst classes = classnames(\n\t\t\tclassName,\n\t\t\t'components-form-token-field__input-container',\n\t\t\t{\n\t\t\t\t'is-active': this.state.isActive,\n\t\t\t\t'is-disabled': disabled,\n\t\t\t}\n\t\t);\n\n\t\tlet tokenFieldProps = {\n\t\t\tclassName: 'components-form-token-field',\n\t\t\ttabIndex: '-1',\n\t\t};\n\t\tconst matchingSuggestions = this.getMatchingSuggestions();\n\n\t\tif ( ! disabled ) {\n\t\t\ttokenFieldProps = Object.assign( {}, tokenFieldProps, {\n\t\t\t\tonKeyDown: this.onKeyDown,\n\t\t\t\tonKeyPress: this.onKeyPress,\n\t\t\t\tonFocus: this.onFocus,\n\t\t\t} );\n\t\t}\n\n\t\t// Disable reason: There is no appropriate role which describes the\n\t\t// input container intended accessible usability.\n\t\t// TODO: Refactor click detection to use blur to stop propagation.\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\treturn (\n\t\t\t<div { ...tokenFieldProps }>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor={ `components-form-token-input-${ instanceId }` }\n\t\t\t\t\tclassName=\"components-form-token-field__label\"\n\t\t\t\t>\n\t\t\t\t\t{ label }\n\t\t\t\t</label>\n\t\t\t\t<div\n\t\t\t\t\tref={ this.bindTokensAndInput }\n\t\t\t\t\tclassName={ classes }\n\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\tonMouseDown={ this.onContainerTouched }\n\t\t\t\t\tonTouchStart={ this.onContainerTouched }\n\t\t\t\t>\n\t\t\t\t\t{ this.renderTokensAndInput() }\n\t\t\t\t\t{ isExpanded && (\n\t\t\t\t\t\t<SuggestionsList\n\t\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\t\tmatch={ this.props.saveTransform(\n\t\t\t\t\t\t\t\tthis.state.incompleteTokenValue\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tdisplayTransform={ this.props.displayTransform }\n\t\t\t\t\t\t\tsuggestions={ matchingSuggestions }\n\t\t\t\t\t\t\tselectedIndex={ this.state.selectedSuggestionIndex }\n\t\t\t\t\t\t\tscrollIntoView={\n\t\t\t\t\t\t\t\tthis.state.selectedSuggestionScroll\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonHover={ this.onSuggestionHovered }\n\t\t\t\t\t\t\tonSelect={ this.onSuggestionSelected }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t\t{ __experimentalShowHowTo && (\n\t\t\t\t\t<p\n\t\t\t\t\t\tid={ `components-form-token-suggestions-howto-${ instanceId }` }\n\t\t\t\t\t\tclassName=\"components-form-token-field__help\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{ this.props.tokenizeOnSpace\n\t\t\t\t\t\t\t? __(\n\t\t\t\t\t\t\t\t\t'Separate with commas, spaces, or the Enter key.'\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: __( 'Separate with commas or the Enter key.' ) }\n\t\t\t\t\t</p>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t}\n}\n\nFormTokenField.defaultProps = {\n\tsuggestions: Object.freeze( [] ),\n\tmaxSuggestions: 100,\n\tvalue: Object.freeze( [] ),\n\tdisplayTransform: identity,\n\tsaveTransform: ( token ) => token.trim(),\n\tonChange: () => {},\n\tonInputChange: () => {},\n\tisBorderless: false,\n\tdisabled: false,\n\ttokenizeOnSpace: false,\n\tmessages: {\n\t\tadded: __( 'Item added.' ),\n\t\tremoved: __( 'Item removed.' ),\n\t\tremove: __( 'Remove item' ),\n\t\t__experimentalInvalid: __( 'Invalid item' ),\n\t},\n\t__experimentalExpandOnFocus: false,\n\t__experimentalValidateInput: () => true,\n\t__experimentalShowHowTo: true,\n};\n\nexport default withSpokenMessages( withInstanceId( FormTokenField ) );\n"]}