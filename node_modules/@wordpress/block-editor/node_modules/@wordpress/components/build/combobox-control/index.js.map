{"version":3,"sources":["@wordpress/components/src/combobox-control/index.js"],"names":["DetectOutside","Component","handleFocusOutside","event","props","onFocusOutside","render","children","ComboboxControl","value","label","options","onChange","onFilterValueChange","noop","hideLabelFromVision","help","allowReset","className","messages","selected","instanceId","selectedSuggestion","setSelectedSuggestion","isExpanded","setIsExpanded","inputValue","setInputValue","inputContainer","currentOption","find","option","currentLabel","matchingSuggestions","startsWithMatch","containsMatch","match","toLocaleLowerCase","forEach","index","indexOf","push","concat","onSuggestionSelected","newSelectedSuggestion","handleArrowNavigation","offset","nextIndex","length","onKeyDown","preventDefault","defaultPrevented","keyCode","ENTER","UP","DOWN","ESCAPE","onFocus","onInputChange","text","handleOnReset","current","input","focus","hasMatchingSuggestions","message","closeSmall","suggestion"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { noop, deburr } from 'lodash';\n/**\n * WordPress dependencies\n */\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport {\n\tComponent,\n\tuseState,\n\tuseMemo,\n\tuseRef,\n\tuseEffect,\n} from '@wordpress/element';\nimport { useInstanceId } from '@wordpress/compose';\nimport { ENTER, UP, DOWN, ESCAPE } from '@wordpress/keycodes';\nimport { speak } from '@wordpress/a11y';\nimport { closeSmall } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport TokenInput from '../form-token-field/token-input';\nimport SuggestionsList from '../form-token-field/suggestions-list';\nimport BaseControl from '../base-control';\nimport Button from '../button';\nimport { Flex, FlexBlock, FlexItem } from '../flex';\nimport withFocusOutside from '../higher-order/with-focus-outside';\n\nconst DetectOutside = withFocusOutside(\n\tclass extends Component {\n\t\thandleFocusOutside( event ) {\n\t\t\tthis.props.onFocusOutside( event );\n\t\t}\n\n\t\trender() {\n\t\t\treturn this.props.children;\n\t\t}\n\t}\n);\n\nfunction ComboboxControl( {\n\tvalue,\n\tlabel,\n\toptions,\n\tonChange,\n\tonFilterValueChange = noop,\n\thideLabelFromVision,\n\thelp,\n\tallowReset = true,\n\tclassName,\n\tmessages = {\n\t\tselected: __( 'Item selected.' ),\n\t},\n} ) {\n\tconst instanceId = useInstanceId( ComboboxControl );\n\tconst [ selectedSuggestion, setSelectedSuggestion ] = useState( null );\n\tconst [ isExpanded, setIsExpanded ] = useState( false );\n\tconst [ inputValue, setInputValue ] = useState( '' );\n\tconst inputContainer = useRef();\n\tconst currentOption = options.find( ( option ) => option.value === value );\n\tconst currentLabel = currentOption?.label ?? '';\n\n\tconst matchingSuggestions = useMemo( () => {\n\t\tconst startsWithMatch = [];\n\t\tconst containsMatch = [];\n\t\tconst match = deburr( inputValue.toLocaleLowerCase() );\n\t\toptions.forEach( ( option ) => {\n\t\t\tconst index = deburr( option.label )\n\t\t\t\t.toLocaleLowerCase()\n\t\t\t\t.indexOf( match );\n\t\t\tif ( index === 0 ) {\n\t\t\t\tstartsWithMatch.push( option );\n\t\t\t} else if ( index > 0 ) {\n\t\t\t\tcontainsMatch.push( option );\n\t\t\t}\n\t\t} );\n\n\t\treturn startsWithMatch.concat( containsMatch );\n\t}, [ inputValue, options, value ] );\n\n\tconst onSuggestionSelected = ( newSelectedSuggestion ) => {\n\t\tonChange( newSelectedSuggestion.value );\n\t\tspeak( messages.selected, 'assertive' );\n\t\tsetSelectedSuggestion( newSelectedSuggestion );\n\t\tsetInputValue( '' );\n\t\tsetIsExpanded( false );\n\t};\n\n\tconst handleArrowNavigation = ( offset = 1 ) => {\n\t\tconst index = matchingSuggestions.indexOf( selectedSuggestion );\n\t\tlet nextIndex = index + offset;\n\t\tif ( nextIndex < 0 ) {\n\t\t\tnextIndex = matchingSuggestions.length - 1;\n\t\t} else if ( nextIndex >= matchingSuggestions.length ) {\n\t\t\tnextIndex = 0;\n\t\t}\n\t\tsetSelectedSuggestion( matchingSuggestions[ nextIndex ] );\n\t\tsetIsExpanded( true );\n\t};\n\n\tconst onKeyDown = ( event ) => {\n\t\tlet preventDefault = false;\n\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase ENTER:\n\t\t\t\tif ( selectedSuggestion ) {\n\t\t\t\t\tonSuggestionSelected( selectedSuggestion );\n\t\t\t\t\tpreventDefault = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UP:\n\t\t\t\thandleArrowNavigation( -1 );\n\t\t\t\tpreventDefault = true;\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\thandleArrowNavigation( 1 );\n\t\t\t\tpreventDefault = true;\n\t\t\t\tbreak;\n\t\t\tcase ESCAPE:\n\t\t\t\tsetIsExpanded( false );\n\t\t\t\tsetSelectedSuggestion( null );\n\t\t\t\tpreventDefault = true;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t};\n\n\tconst onFocus = () => {\n\t\tsetIsExpanded( true );\n\t\tonFilterValueChange( '' );\n\t\tsetInputValue( '' );\n\t};\n\n\tconst onFocusOutside = () => {\n\t\tsetIsExpanded( false );\n\t};\n\n\tconst onInputChange = ( event ) => {\n\t\tconst text = event.value;\n\t\tsetInputValue( text );\n\t\tonFilterValueChange( text );\n\t\tsetIsExpanded( true );\n\t};\n\n\tconst handleOnReset = () => {\n\t\tonChange( null );\n\t\tinputContainer.current.input.focus();\n\t};\n\n\t// Announcements\n\tuseEffect( () => {\n\t\tconst hasMatchingSuggestions = matchingSuggestions.length > 0;\n\t\tif ( isExpanded ) {\n\t\t\tconst message = hasMatchingSuggestions\n\t\t\t\t? sprintf(\n\t\t\t\t\t\t/* translators: %d: number of results. */\n\t\t\t\t\t\t_n(\n\t\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t  )\n\t\t\t\t: __( 'No results.' );\n\n\t\t\tspeak( message, 'polite' );\n\t\t}\n\t}, [ matchingSuggestions, isExpanded ] );\n\n\t// Disable reason: There is no appropriate role which describes the\n\t// input container intended accessible usability.\n\t// TODO: Refactor click detection to use blur to stop propagation.\n\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\treturn (\n\t\t<DetectOutside onFocusOutside={ onFocusOutside }>\n\t\t\t<BaseControl\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\tclassName,\n\t\t\t\t\t'components-combobox-control'\n\t\t\t\t) }\n\t\t\t\ttabIndex=\"-1\"\n\t\t\t\tlabel={ label }\n\t\t\t\tid={ `components-form-token-input-${ instanceId }` }\n\t\t\t\thideLabelFromVision={ hideLabelFromVision }\n\t\t\t\thelp={ help }\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"components-combobox-control__suggestions-container\"\n\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\tonKeyDown={ onKeyDown }\n\t\t\t\t>\n\t\t\t\t\t<Flex>\n\t\t\t\t\t\t<FlexBlock>\n\t\t\t\t\t\t\t<TokenInput\n\t\t\t\t\t\t\t\tclassName=\"components-combobox-control__input\"\n\t\t\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\t\t\tref={ inputContainer }\n\t\t\t\t\t\t\t\tvalue={ isExpanded ? inputValue : currentLabel }\n\t\t\t\t\t\t\t\taria-label={\n\t\t\t\t\t\t\t\t\tcurrentLabel\n\t\t\t\t\t\t\t\t\t\t? `${ currentLabel }, ${ label }`\n\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\t\t\t\tisExpanded={ isExpanded }\n\t\t\t\t\t\t\t\tselectedSuggestionIndex={ matchingSuggestions.indexOf(\n\t\t\t\t\t\t\t\t\tselectedSuggestion\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\tonChange={ onInputChange }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FlexBlock>\n\t\t\t\t\t\t{ allowReset && (\n\t\t\t\t\t\t\t<FlexItem>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName=\"components-combobox-control__reset\"\n\t\t\t\t\t\t\t\t\ticon={ closeSmall }\n\t\t\t\t\t\t\t\t\tdisabled={ ! value }\n\t\t\t\t\t\t\t\t\tonClick={ handleOnReset }\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Reset' ) }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FlexItem>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</Flex>\n\t\t\t\t\t{ isExpanded && (\n\t\t\t\t\t\t<SuggestionsList\n\t\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\t\tmatch={ { label: inputValue } }\n\t\t\t\t\t\t\tdisplayTransform={ ( suggestion ) =>\n\t\t\t\t\t\t\t\tsuggestion.label\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsuggestions={ matchingSuggestions }\n\t\t\t\t\t\t\tselectedIndex={ matchingSuggestions.indexOf(\n\t\t\t\t\t\t\t\tselectedSuggestion\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tonHover={ setSelectedSuggestion }\n\t\t\t\t\t\t\tonSelect={ onSuggestionSelected }\n\t\t\t\t\t\t\tscrollIntoView\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t</BaseControl>\n\t\t</DetectOutside>\n\t);\n\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n}\n\nexport default ComboboxControl;\n"]}